!function(a,b){"use strict";b.module("jmdobry.angular-i18n-properties",["ng"]),b.module("jmdobry.angular-i18n-properties").provider("I18nService",function(){function a(a){return a=a.toLowerCase(),a.length>=5&&(a=a.substr(0,2)+"_"+a.substr(3).toUpperCase()),a}var c={},d={async:!0,cacheMode:"none",baseUrl:"",lang:navigator.language||navigator.userLanguage,encoding:"UTF-8"};this.config=function(d){b.extend(c,d),c.lang=a(c.lang)},this.config(d),this.$get=["$log","$q","$http",function(d,e,f){function g(a){return"string"==typeof a?a.replace(/^\s*/,""):a}function h(a){var b,c,d,e=[],f="";for(b=parseInt(a.substr(2),16),b>=0&&b<Math.pow(2,16)&&e.push(b),d=e.length,c=0;d>c;++c)f+=String.fromCharCode(e[c]);return f}function i(a){if("string"==typeof a){var b,c,d=a.match(m);if(d)for(b=d.length,c=0;b>c;c++)a=a.replace(d[c],h(d[c]));for(c=0;-1!=(c=a.indexOf("\\",c));)"t"==a[c+1]?a=a.substring(0,c)+"	"+a.substring(c++ +2):"r"==a[c+1]?a=a.substring(0,c)+"\r"+a.substring(c++ +2):"n"==a[c+1]?a=a.substring(0,c)+"\n"+a.substring(c++ +2):"f"==a[c+1]?a=a.substring(0,c)+"\f"+a.substring(c++ +2):"\\"==a[c+1]?a=a.substring(0,c)+"\\"+a.substring(c++ +2):"{"==a[c+1]||"}"==a[c+1]||(a=a.substring(0,c)+a.substring(c+1)),c++}return a}function j(a,b){var c=b.baseUrl;return b.lang&&(c&&"/"!==c[c.length-1]&&(c+="/"),c=c+b.lang+"/"),c&&"/"!==a[0]&&"/"!==c[c.length-1]&&(c+="/"),c+=a,-1===a.indexOf(".properties")&&(c+=".properties"),c}function k(a,b){return b=b||"default",l[b]||(l[b]={}),l[b][a]}var l={},m=/(\\u.{4})/gi,n=/[(\r\n)\n\r]+/,o=/\\[\s=:]+?/,p=/[=:]|\s+[=:]|\s+(?![=:])/;return{get:function(d,e,f){var g,h,i,j,l,m=b.extend({},c,f||{}),n=a(m.lang)||"default",o=n.split("_");if(l=j=k(d,n),!j&&""!==j&&o.length>1&&(n=o[0],l=j=k(d,n)),j||""===j||(n="default",l=j=k(d,n)),!j&&""!==j)return"";if(e&&e.length){for(var p=0;p<e.length;p++)for(g=new RegExp("\\{"+p+"}");h=j.match(g);)if(i=j.indexOf(h.toString()),i>0){if("\\"===j[i-1]){var q=l.match(/\\\{[0-9]+}/).toString();throw new Error('Invalid unescaped "\\" at column '+(l.indexOf(q)+q.length-1)+' in property value: "'+l+'"')}j=j.substr(0,i)+e[p]+j.substr(i+h.toString().length)}if(h=j.match(/\\\{|\\}/),h&&"\\"===j[j.indexOf(h.toString())-1])throw new Error('Invalid unescaped "\\" in property value: "'+l+'"')}return j.replace("\\{","{").replace("\\}","}")},parse:function(a){var b,c,e,f,h,j,k,l,m={},q=a.split(n);for(c=0;c<q.length;c++){b=g(q[c]);var r="";if("#"!==b[0]&&"!"!==b[0]){if(e=b.match(o),f=b.match(p),e&&f)for(;e&&f&&b.indexOf(e.toString())<b.indexOf(f.toString());)r+=b.substr(0,b.indexOf(e.toString()))+e.toString()[1],b=b.substr(b.indexOf(e.toString())+e.toString().length),e=b.match(o),f=b.match(p);if(f)if(h=null,j=b.indexOf(f.toString()),k=r+b.substr(0,j),h=k.match(/\s*$/),h&&h.toString().length)d.error("Could not parse line number "+c+": Unescaped whitespace at column "+k.indexOf(h)+".");else{for(l=g(b.substr(j+f.toString().length));l.match(/\\$/)&&"\\"===l.match(/\\$/).toString();)l=l.substring(0,l.length-1),l+=g(q[++c].replace(/\s\s*$/,""));m[i(k).replace("\\{","{").replace("\\}","}")]=i(l)}}}return m},load:function(g,h){var i=e.defer(),k=b.extend({},c,h||{}),m=j(g,k),n=this,o=!1,p=[i.promise],q=a(k.lang),r=q.split("_");switch(k.cacheMode){case"none":m+=(/\?/.test(m)?"&":"?")+(new Date).getTime();break;case"browser":break;case"angular":o=!0}return f.get(m,{cache:o,headers:{"Content-Type":"text/plain;charset="+k.encoding}}).success(function(a,c,d,e){l[q||"default"]||(l[q||"default"]={}),b.extend(l[q||"default"],n.parse(a)),i.resolve({filename:g,lang:q||"default",contents:a},c,d,e)}).error(function(a,b,c,e){d.error('Failed to load "'+m+'"'),i.reject({filename:g,lang:q,contents:"404 - Not Found"},b,c,e)}),r.length>1?(k.lang=r[0],p=p.concat(this.load(g,k))):q&&(k.lang="",p=p.concat(this.load(g,k))),p}}}]}),b.module("jmdobry.angular-i18n-properties").filter("i18n",["$log","I18nService",function(a,b){return function(a,c){return b.get(a,c)}}])}(window,window.angular);